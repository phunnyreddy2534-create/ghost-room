<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ghost Room</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

<header class="top">
  <div class="logo">ğŸ‘» Ghost Room</div>
</header>

<main class="home">
  <h1>Anonymous. No Login. Speak Freely.</h1>
  <p>Private rooms that vanish without a trace.</p>

  <div class="room-actions">
    <button id="createBtn" class="primary-btn">Create New Room</button>
    <button id="joinOpenBtn" class="secondary-btn">Join Room</button>
  </div>

  <div id="homeMessage"></div>

  <section class="why">
    <h2>Why Ghost Room?</h2>
    <ul>
      <li>ğŸ•¶ï¸ No identity</li>
      <li>â³ Creator-defined expiry</li>
      <li>ğŸ”’ No logs</li>
      <li>ğŸ’¬ Honest conversations</li>
    </ul>
  </section>

  <p class="about-link">
    <a href="about.html">About, Vision & Trust â†’</a>
  </p>
</main>

<!-- CREATE MODAL -->
<div id="createModal" class="modal hidden">
  <div class="premium-card">
    <h2>ğŸ‘» Create Ghost Room</h2>
    <p class="subtitle">Private â€¢ Temporary â€¢ Anonymous</p>

    <div class="option">
      â³ <strong>Room Expiry</strong>
      <select id="expirySelect">
        <option value="30">30 minutes</option>
        <option value="60">1 hour</option>
        <option value="1440">24 hours</option>
      </select>
    </div>

    <div class="option locked">âš™ï¸ Custom Rules (Coming Soon)</div>

    <label class="agree">
      <input type="checkbox" id="agreeRules">
      I understand and agree
    </label>

    <div class="card-actions">
      <button id="cancelCreate" class="ghost-btn">Cancel</button>
      <button id="confirmCreate" class="primary-btn">Create Room</button>
    </div>
  </div>
</div>

<!-- JOIN MODAL -->
<div id="joinModal" class="modal hidden">
  <div class="premium-card">
    <h2>ğŸ” Join Ghost Room</h2>
    <p class="subtitle">Enter quietly</p>

    <button class="ghost-btn" disabled>ğŸ“· Scan QR (Coming Soon)</button>

    <input id="joinCode" placeholder="Enter Room Code" />

    <div class="card-actions">
      <button id="cancelJoin" class="ghost-btn">Cancel</button>
      <button id="confirmJoin" class="primary-btn">Join Room</button>
    </div>
  </div>
</div>

<script>
const supabaseClient = supabase.createClient(
  "https://ehvusinvfwsaxguuebfc.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVodnVzaW52ZndzYXhndXVlYmZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczNTcyMzYsImV4cCI6MjA4MjkzMzIzNn0.6W8OrbTz6RhN3P3R0KIN80Ec9GlkoMF4F0-Q4xRyy48"
);

function showHomeMessage(msg){
  document.getElementById("homeMessage").textContent = msg;
}

async function createRoom(){
  const id = Math.random().toString(36).substring(2,8);
  const expiryMinutes = parseInt(document.getElementById("expirySelect").value, 10);

  const now = new Date();
  const expiresAt = new Date(now.getTime() + expiryMinutes * 60000);

  showHomeMessage("Creating secure roomâ€¦");

  try{
    await supabaseClient.from("rooms").insert([{
      room_code: id,
      expired: false,
      expiry_minutes: expiryMinutes,
      expires_at: expiresAt.toISOString(),
      created_at: now.toISOString()
    }]);
  }catch(e){}

  window.location.href = `room.html?room=${id}`;
}

/* MODAL HANDLERS */
createBtn.onclick = ()=>createModal.classList.remove("hidden");
cancelCreate.onclick = ()=>createModal.classList.add("hidden");

confirmCreate.onclick = ()=>{
  if(!agreeRules.checked){ alert("Accept rules"); return; }
  createModal.classList.add("hidden");
  createRoom();
};

joinOpenBtn.onclick = ()=>joinModal.classList.remove("hidden");
cancelJoin.onclick = ()=>joinModal.classList.add("hidden");

confirmJoin.onclick = ()=>{
  const code = joinCode.value.trim();
  if(!code){ alert("Enter room code"); return; }
  window.location.href = `room.html?room=${code}`;
};
</script>

</body>
</html>
