<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IRA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

<header class="top">
  <div class="logo">
    <img src="ira-logo.png" alt="IRA" class="logo-img" />
    <span class="logo-text">IRA</span>
  </div>
</header>

<main class="home">
  <h1>Speak freely.</h1>
  <p class="hero-sub">
    Private rooms that appear quietly â€” and vanish without a trace.
  </p>

  <div class="room-actions">
    <button id="createBtn" class="primary-btn">Create Room</button>
    <button id="joinOpenBtn" class="secondary-btn">Join Room</button>
  </div>

  <div id="homeMessage"></div>

  <section class="why">
    <h2>Why IRA?</h2>
    <ul>
      <li>ğŸ¤ No identity, ever</li>
      <li>â³ Rooms expire by design</li>
      <li>ğŸ”’ No logs, no recovery</li>
      <li>ğŸŒŠ Silence is allowed</li>
    </ul>
  </section>

  <p class="about-link">
    <a href="about.html">About Â· Vision Â· Trust â†’</a>
  </p>
</main>

<!-- CREATE ROOM MODAL -->
<div id="createModal" class="modal hidden">
  <div class="premium-card">

    <h2>Create a private room</h2>
    <p class="subtitle">Temporary Â· Anonymous Â· Quiet</p>

    <div class="option">
      <strong>Room lifetime</strong>

      <input
        type="range"
        id="lifetimeRange"
        min="1"
        max="1440"
        value="30"
        class="range"
      />

      <small class="range-helper">
        From <strong>1 minute</strong> to <strong>24 hours</strong>
      </small>

      <div class="range-label" id="lifetimeLabel">
        This room will quietly disappear in <strong>30 minutes</strong>.
      </div>

      <small class="hint">
        Rooms may disappear sooner if left inactive.
      </small>
    </div>

    <label class="agree">
      <input type="checkbox" id="agreeRules">
      I understand this room cannot be recovered
    </label>

    <div class="card-actions">
      <button id="cancelCreate" class="ghost-btn">Cancel</button>
      <button id="confirmCreate" class="primary-btn">Create & Enter</button>
    </div>

  </div>
</div>

<!-- JOIN ROOM MODAL -->
<div id="joinModal" class="modal hidden">
  <div class="premium-card">

    <h2>Enter quietly</h2>
    <p class="subtitle">You wonâ€™t leave a trace.</p>

    <button class="ghost-btn wide" disabled>
      Scan QR (coming soon)
    </button>

    <input id="joinCode" placeholder="Room code" />

    <div class="card-actions">
      <button id="cancelJoin" class="ghost-btn">Cancel</button>
      <button id="confirmJoin" class="primary-btn">Join Room</button>
    </div>

  </div>
</div>

<script>
/* ================= SUPABASE (UNCHANGED) ================= */
const supabaseClient = supabase.createClient(
  "https://ehvusinvfwsaxguuebfc.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVodnVzaW52ZndzYXhndXVlYmZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczNTcyMzYsImV4cCI6MjA4MjkzMzIzNn0.6W8OrbTz6RhN3P3R0KIN80Ec9GlkoMF4F0-Q4xRyy48"
);

function showHomeMessage(msg){
  document.getElementById("homeMessage").textContent = msg;
}

/* ================= CREATE ROOM (UNCHANGED) ================= */
async function createRoom(){
  const id = Math.random().toString(36).substring(2,8);
  showHomeMessage("Creating secure roomâ€¦");
  try{
    await supabaseClient.from("rooms").insert([{ room_code:id, expired:false }]);
  }catch(e){}
  window.location.href = `room.html?room=${id}`;
}

/* ================= UI ================= */
const lifetimeRange = document.getElementById("lifetimeRange");
const lifetimeLabel = document.getElementById("lifetimeLabel");

lifetimeRange.oninput = () => {
  const minutes = parseInt(lifetimeRange.value, 10);
  let text =
    minutes < 60
      ? `${minutes} minutes`
      : minutes < 1440
        ? `${Math.round(minutes / 60)} hours`
        : `24 hours`;

  lifetimeLabel.innerHTML =
    `This room will quietly disappear in <strong>${text}</strong>.`;
};

confirmCreate.onclick = () => {
  if(!agreeRules.checked){
    alert("Please agree to continue");
    return;
  }
  createModal.classList.add("hidden");
  createRoom();
};

confirmJoin.onclick = () => {
  const code = joinCode.value.trim();
  if(!code){
    alert("Enter room code");
    return;
  }
  window.location.href = `room.html?room=${code}`;
};

createBtn.onclick = ()=>createModal.classList.remove("hidden");
cancelCreate.onclick = ()=>createModal.classList.add("hidden");

joinOpenBtn.onclick = ()=>joinModal.classList.remove("hidden");
cancelJoin.onclick = ()=>joinModal.classList.add("hidden");
</script>

</body>
</html>
