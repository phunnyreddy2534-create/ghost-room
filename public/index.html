<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IRA â€” Silent Anonymous Rooms</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="/config.js"></script>
</head>

<body>

<header class="top">
  <div class="logo">
    <span class="logo-text">IRA</span>
  </div>
</header>

<main class="home">
  <h1>Speak freely.</h1>
  <p class="hero-sub">Private rooms that vanish without a trace.</p>

  <div class="room-actions">
    <button class="primary-btn" id="createBtn">Create Room</button>
    <button class="secondary-btn" id="joinBtn">Join Room</button>
  </div>
</main>

<script>
/* ===== INIT ===== */
const supabase = window.supabase.createClient(
  IRA_CONFIG.SUPABASE_URL,
  IRA_CONFIG.SUPABASE_ANON_KEY
);

/* ===== HELPERS ===== */
function generateRoomCode(){
  return Math.random().toString(36).slice(2, 9);
}

/* ===== CREATE ROOM ===== */
document.getElementById("createBtn").addEventListener("click", async () => {
  const roomCode = generateRoomCode();
  const expiresAt = new Date(Date.now() + 30 * 60 * 1000);

  const { error } = await supabase.from("rooms").insert({
    room_code: roomCode,
    expires_at: expiresAt.toISOString()
  });

  if (error) {
    alert("Failed to create room");
    console.error(error);
    return;
  }

  location.href = `/room.html?room=${roomCode}`;
});

/* ===== JOIN ROOM ===== */
document.getElementById("joinBtn").addEventListener("click", async () => {
  const code = prompt("Enter room code");
  if (!code) return;

  const { data } = await supabase
    .from("rooms")
    .select("room_code")
    .eq("room_code", code)
    .maybeSingle();

  if (!data) {
    alert("Room does not exist");
    return;
  }

  location.href = `/room.html?room=${code}`;
});
</script>

</body>
</html>
