<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>IRA — Silent Anonymous Rooms</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#141633" />

  <link rel="stylesheet" href="style.css" />

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <style>
    /* ===== Splash ===== */
    #appSplash{
      position:fixed;
      inset:0;
      background:radial-gradient(circle at top,#161844,#0A0B14 70%);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:9999;
      animation:fadeOut .8s ease forwards;
      animation-delay:2.4s;
    }
    @keyframes fadeOut{to{opacity:0;visibility:hidden}}

    .hero-title{font-size:36px;line-height:1.15}

    /* ===== Modal ===== */
    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.45);
      backdrop-filter:blur(6px);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:3000;
    }
    .hidden{display:none}

    .glass-card{
      width:min(92%,420px);
      background:rgba(20,22,45,.6);
      backdrop-filter:blur(18px);
      border-radius:22px;
      padding:22px;
      box-shadow:0 20px 60px rgba(0,0,0,.45);
      animation:modalIn .25s ease;
    }
    @keyframes modalIn{
      from{opacity:0;transform:scale(.96)}
      to{opacity:1;transform:none}
    }

    .field{display:flex;flex-direction:column;gap:6px;margin-bottom:16px}
    .field span{font-size:13px;color:rgba(255,255,255,.7)}

    .field input,.field textarea{
      background:#141633;
      border:none;
      border-radius:14px;
      padding:12px 14px;
      color:white;
      font-size:14px;
      outline:none;
    }

    /* ===== Slider ===== */
    .slider-wrap{
      background:#141633;
      border-radius:16px;
      padding:14px;
    }

    .slider-label{
      display:flex;
      justify-content:space-between;
      font-size:13px;
      color:rgba(255,255,255,.7);
      margin-bottom:6px;
    }

    input[type="range"]{
      width:100%;
    }

    .slider-value{
      text-align:center;
      margin-top:8px;
      font-size:14px;
      color:#9fa7ff;
      font-weight:500;
    }

    .agree{
      display:flex;
      gap:10px;
      font-size:13px;
      color:rgba(255,255,255,.7);
      margin:12px 0;
    }

    .terms-warning{
      font-size:13px;
      color:#ff9b9b;
      margin-top:6px;
    }

    .card-actions{
      display:flex;
      gap:12px;
      margin-top:18px;
    }

    .primary-btn[disabled]{
      opacity:.5;
      pointer-events:none;
    }
  </style>
</head>

<body>

<!-- SPLASH -->
<div id="appSplash">
  <svg viewBox="0 0 100 100" width="88" height="88">
    <circle cx="50" cy="50" r="42" fill="none" stroke="#8E97FF" stroke-width="4"/>
    <path d="M20 52 C30 46 40 46 50 52 C60 58 70 58 80 52"
      fill="none" stroke="#6F7CFF" stroke-width="3" stroke-linecap="round"/>
  </svg>
</div>

<header class="top">
  <div class="logo">
    <svg class="ira-logo" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="42" fill="none" stroke="#6F7CFF" stroke-width="4"/>
      <path class="ira-wave"
        d="M20 52 C30 46 40 46 50 52 C60 58 70 58 80 52"
        fill="none" stroke="#8E97FF" stroke-width="3" stroke-linecap="round"/>
    </svg>
    <span class="logo-text">IRA</span>
  </div>
</header>

<main class="home">
  <h1 class="hero-title">Speak freely.</h1>
  <p class="hero-sub">Private rooms that appear quietly — and vanish without a trace.</p>

  <div class="room-actions">
    <button class="primary-btn" id="createBtn">Create Room</button>
    <button class="secondary-btn" id="joinBtn">Join Room</button>
  </div>
</main>

<!-- CREATE ROOM MODAL -->
<div id="createRoomModal" class="modal hidden">
  <div class="glass-card">

    <h2>Create a quiet room</h2>
    <p class="subtitle">Only people with the link can enter. This room will disappear.</p>

    <label class="field">
      <span>Room name (optional)</span>
      <input id="roomName" placeholder="A quiet space…" />
    </label>

    <label class="field">
      <span>Description (optional)</span>
      <textarea id="roomDesc" rows="3" placeholder="What is this room for?"></textarea>
    </label>

    <!-- SLIDER -->
    <div class="field">
      <span>How long should this room exist?</span>
      <div class="slider-wrap">
        <div class="slider-label">
          <span>Short</span>
          <span>Long</span>
        </div>
        <input type="range" id="roomDuration" min="0" max="4" step="1" value="1">
        <div class="slider-value" id="durationText"></div>
      </div>
    </div>

    <label class="agree">
      <input type="checkbox" id="agreeTerms" />
      I understand this room will vanish and cannot be recovered
    </label>

    <p id="termsWarning" class="terms-warning hidden">
      Please accept the terms to continue.
    </p>

    <div class="card-actions">
      <button class="ghost-btn" id="cancelCreate">Cancel</button>
      <button class="primary-btn" id="confirmCreate" disabled>
        Create & Enter
      </button>
    </div>

  </div>
</div>

<script>
function makeRoomId(){
  return Math.random().toString(36).slice(2,9);
}
function goToRoom(id){
  location.href = `room.html?room=${encodeURIComponent(id)}`;
}

const DURATIONS = [
  {label:"15 minutes — Short moment", value:15},
  {label:"30 minutes — Quiet space", value:30},
  {label:"1 hour — Deep talk", value:60},
  {label:"3 hours — Long presence", value:180},
  {label:"24 hours — Lasts a day", value:1440}
];

document.addEventListener("DOMContentLoaded", ()=>{

  const createBtn = document.getElementById("createBtn");
  const joinBtn = document.getElementById("joinBtn");
  const modal = document.getElementById("createRoomModal");
  const cancelCreate = document.getElementById("cancelCreate");
  const confirmCreate = document.getElementById("confirmCreate");
  const agreeTerms = document.getElementById("agreeTerms");
  const warning = document.getElementById("termsWarning");
  const slider = document.getElementById("roomDuration");
  const durationText = document.getElementById("durationText");

  function updateDuration(){
    durationText.textContent = DURATIONS[slider.value].label;
  }
  updateDuration();
  slider.oninput = updateDuration;

  createBtn.onclick = () => modal.classList.remove("hidden");
  cancelCreate.onclick = () => modal.classList.add("hidden");

  agreeTerms.onchange = () => {
    confirmCreate.disabled = !agreeTerms.checked;
    warning.classList.add("hidden");
  };

  confirmCreate.onclick = () => {
    if(!agreeTerms.checked){
      warning.classList.remove("hidden");
      return;
    }

    sessionStorage.setItem("ira_room_meta", JSON.stringify({
      name: roomName.value.trim(),
      desc: roomDesc.value.trim(),
      duration: DURATIONS[slider.value].value,
      createdAt: Date.now()
    }));

    goToRoom(makeRoomId());
  };

  joinBtn.onclick = () => {
    let code = prompt("Enter room code or link:");
    if(!code) return;
    try{
      const u = new URL(code, location.href);
      code = u.searchParams.get("room") || code;
    }catch(e){}
    if(code.trim()) goToRoom(code.trim());
  };
});
</script>

</body>
</html>
