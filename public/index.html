<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Ghost Room</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" href="style.css" />
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

<header class="top">
  <div class="logo">ğŸ‘» Ghost Room</div>
</header>

<main class="home" id="home">
  <h1>Anonymous. No Login. Speak Freely.</h1>
  <p>Private rooms that vanish without a trace.</p>

  <div class="room-actions">
    <button id="createBtn" class="primary-btn">Create New Room</button>
    <button id="joinOpenBtn" class="secondary-btn">Join Room</button>
  </div>

  <section class="why">
    <h2>Why Ghost Room?</h2>
    <ul>
      <li>ğŸ•¶ï¸ No identity</li>
      <li>â³ Creator-defined expiry</li>
      <li>ğŸ«¥ Auto-expire on inactivity</li>
      <li>ğŸ”’ No logs</li>
    </ul>
  </section>
</main>

<!-- CREATE MODAL -->
<div id="createModal" class="modal hidden">
  <div class="glass-card">

    <h2>ğŸ‘» Create Ghost Room</h2>
    <p class="subtitle">Private â€¢ Temporary â€¢ Anonymous</p>

    <!-- HARD EXPIRY -->
    <div class="section">
      <label>â³ Room Lifetime</label>
      <div class="pill-row" id="expiryPills">
        <button data-min="30" class="pill active">30 min</button>
        <button data-min="60" class="pill">1 hour</button>
        <button data-min="1440" class="pill">24 hours</button>
      </div>
    </div>

    <!-- INACTIVITY EXPIRY -->
    <div class="section">
      <label>ğŸ«¥ Inactivity Expiry</label>
      <div class="pill-row" id="inactivePills">
        <button data-min="15" class="pill">15 min</button>
        <button data-min="30" class="pill active">30 min</button>
        <button data-min="60" class="pill">1 hour</button>
      </div>
      <small>No messages â†’ room expires</small>
    </div>

    <!-- RULES -->
    <div class="section locked">
      âš™ï¸ Custom Rules (Creator-only â€“ coming soon)
    </div>

    <label class="agree">
      <input type="checkbox" id="agreeRules">
      I understand and agree
    </label>

    <div class="card-actions">
      <button id="cancelCreate" class="ghost-btn">Cancel</button>
      <button id="confirmCreate" class="primary-btn">Create Room</button>
    </div>

  </div>
</div>

<!-- JOIN MODAL -->
<div id="joinModal" class="modal hidden">
  <div class="glass-card">

    <h2>ğŸ” Join Ghost Room</h2>
    <p class="subtitle">Enter quietly</p>

    <input id="joinCode" placeholder="Enter Room Code" />

    <div class="card-actions">
      <button id="cancelJoin" class="ghost-btn">Cancel</button>
      <button id="confirmJoin" class="primary-btn">Join Room</button>
    </div>

  </div>
</div>

<script>
const supabaseClient = supabase.createClient(
  "https://ehvusinvfwsaxguuebfc.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVodnVzaW52ZndzYXhndXVlYmZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczNTcyMzYsImV4cCI6MjA4MjkzMzIzNn0.6W8OrbTz6RhN3P3R0KIN80Ec9GlkoMF4F0-Q4xRyy48"
);

let expiryMinutes = 30;
let inactivityMinutes = 30;

/* PILL HANDLERS */
function setupPills(containerId, setter){
  document.querySelectorAll(`#${containerId} .pill`).forEach(btn=>{
    btn.onclick = ()=>{
      document.querySelectorAll(`#${containerId} .pill`).forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      setter(parseInt(btn.dataset.min,10));
    };
  });
}

setupPills("expiryPills", v=>expiryMinutes=v);
setupPills("inactivePills", v=>inactivityMinutes=v);

/* CREATE ROOM */
confirmCreate.onclick = async ()=>{
  if(!agreeRules.checked){
    alert("Please accept the rules");
    return;
  }

  const roomId = Math.random().toString(36).substring(2,8);
  const creatorKey = crypto.randomUUID();

  const now = new Date();
  const expiresAt = new Date(now.getTime() + expiryMinutes*60000);

  sessionStorage.setItem("ghost_creator_key", creatorKey);

  await supabaseClient.from("rooms").insert([{
    room_code: roomId,
    created_at: now.toISOString(),
    expires_at: expiresAt.toISOString(),
    expiry_minutes: expiryMinutes,
    inactivity_minutes: inactivityMinutes,
    last_activity_at: now.toISOString(),
    creator_key: creatorKey,
    expired: false
  }]);

  location.href = `room.html?room=${roomId}`;
};

/* MODAL CONTROLS */
createBtn.onclick = ()=>toggle(createModal,true);
cancelCreate.onclick = ()=>toggle(createModal,false);

joinOpenBtn.onclick = ()=>toggle(joinModal,true);
cancelJoin.onclick = ()=>toggle(joinModal,false);

confirmJoin.onclick = ()=>{
  if(!joinCode.value.trim()) return;
  location.href = `room.html?room=${joinCode.value.trim()}`;
};

function toggle(el,show){
  el.classList.toggle("hidden",!show);
  document.body.style.overflow = show ? "hidden" : "";
}
</script>

<style>
.modal{
  position:fixed; inset:0;
  background:rgba(0,0,0,.7);
  backdrop-filter:blur(14px);
  display:flex; justify-content:center; align-items:center;
  z-index:999;
}
.hidden{display:none}
.glass-card{
  width:90%; max-width:380px;
  background:rgba(20,20,35,.88);
  border-radius:26px;
  padding:22px;
  animation:fade .25s ease;
}
@keyframes fade{from{opacity:0;transform:scale(.96)}to{opacity:1}}
.section{margin:16px 0}
.pill-row{display:flex;gap:10px;margin-top:8px}
.pill{
  flex:1;padding:10px;border-radius:14px;border:none;
  background:#1b1b2a;color:#aaa;
}
.pill.active{
  background:linear-gradient(135deg,#6d5dfc,#9b8cff);
  color:white;
}
.locked{opacity:.45}
</style>

</body>
</html>
