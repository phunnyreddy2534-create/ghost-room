<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IRA Room</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="./config.js"></script>

<style>
/* === YOUR CSS (UNCHANGED) === */
body{margin:0;height:100vh;display:flex;flex-direction:column;font-family:Inter,system-ui;background:radial-gradient(circle at top,#141633,#050507 70%);color:#fff}
.room-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:rgba(10,11,20,.75)}
.header-left{display:flex;align-items:center;gap:12px}
.menu-btn{font-size:22px;background:none;border:none;color:white;cursor:pointer}
.messages{flex:1;padding:18px 14px;overflow-y:auto;display:flex;flex-direction:column}
.msg{max-width:78%;padding:12px 16px;margin-bottom:12px}
.msg.other{background:#23233b;border-radius:18px}
.input-bar{display:flex;gap:10px;padding:12px;background:#0b0d1a}
.send{padding:12px 18px;border-radius:18px;background:#6F7CFF;color:white;border:none;cursor:pointer}
.menu-overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none}
.menu{position:absolute;top:64px;right:12px;background:#1b1e38;padding:10px;border-radius:18px}
.menu-item{padding:14px;margin-bottom:8px;background:#23233b;border-radius:14px}
.menu-item.danger{background:#3a1f28}
</style>
</head>

<body>

<header class="room-header">
  <div class="header-left">
    <strong>IRA</strong>
  </div>
  <button id="menuBtn" class="menu-btn">‚ò∞</button>
</header>

<div class="messages" id="messages"></div>

<div class="input-bar">
  <input id="msgInput" placeholder="Type without being known‚Ä¶">
  <button id="sendBtn" class="send">Send</button>
</div>

<div id="menuOverlay" class="menu-overlay">
  <div class="menu">
    <div class="menu-item" id="shareBtn">üîó Share quietly</div>
    <div class="menu-item danger" id="exitBtn">üóëÔ∏è Leave</div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  /* üîê HARD CONFIG CHECK */
  if (!window.IRA_CONFIG) {
    alert("config.js not loaded. Check file path or server.");
    console.error("IRA_CONFIG missing");
    return;
  }

  /* ‚úÖ SUPABASE */
  const supabase = window.supabase.createClient(
    IRA_CONFIG.SUPABASE_URL,
    IRA_CONFIG.SUPABASE_ANON_KEY
  );

  const messagesEl = document.getElementById("messages");
  const sendBtn = document.getElementById("sendBtn");
  const msgInput = document.getElementById("msgInput");
  const menuBtn = document.getElementById("menuBtn");
  const menuOverlay = document.getElementById("menuOverlay");
  const shareBtn = document.getElementById("shareBtn");
  const exitBtn = document.getElementById("exitBtn");

  /* MENU */
  menuBtn.onclick = () => menuOverlay.style.display = "block";
  menuOverlay.onclick = e => {
    if (e.target === menuOverlay) menuOverlay.style.display = "none";
  };

  /* SEND */
  sendBtn.onclick = async () => {
    const text = msgInput.value.trim();
    if (!text) return;

    await supabase.from("messages").insert({
      room_code: "default",
      content: text
    });

    msgInput.value = "";
  };

  /* SHARE */
  shareBtn.onclick = () => {
    navigator.clipboard.writeText(location.href);
    alert("Link copied");
  };

  /* EXIT */
  exitBtn.onclick = () => location.href = "/";

  console.log("IRA room ready ‚úÖ");
});
</script>

</body>
</html>
