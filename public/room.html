<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ghost Room</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:system-ui,Inter;
  background:radial-gradient(circle at top,#0c0c20,#050507 70%);
  color:#fff;
  overflow:hidden;
}

/* HEADER */
.room-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
}
.menu-btn{
  font-size:22px;
  background:none;
  border:none;
  color:white;
}

/* CHAT */
.messages{
  padding:16px;
  height:70vh;
  overflow-y:auto;
}
.msg{
  max-width:75%;
  padding:12px 16px;
  border-radius:18px;
  margin-bottom:12px;
  animation:pop .2s ease;
}
.you{
  margin-left:auto;
  background:linear-gradient(135deg,#6d5dfc,#9b8cff);
}
.system{
  text-align:center;
  opacity:.6;
  font-size:14px;
  margin:24px 0;
}
@keyframes pop{
  from{opacity:0;transform:scale(.95)}
  to{opacity:1;transform:none}
}

/* INPUT */
.input-bar{
  display:flex;
  gap:10px;
  padding:12px;
  background:rgba(5,5,7,.85);
  backdrop-filter:blur(10px);
}
input{
  flex:1;
  padding:12px 14px;
  border-radius:20px;
  border:none;
}
.send{
  padding:12px 18px;
  border:none;
  border-radius:18px;
  background:#6d5dfc;
  color:white;
}

/* MENU OVERLAY */
.menu-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  backdrop-filter:blur(6px);
  display:none;
  z-index:1000;
}

/* MENU CARD */
.menu{
  position:absolute;
  top:60px;
  right:12px;
  width:260px;
  background:rgba(18,18,34,.75);
  backdrop-filter:blur(14px);
  border-radius:18px;
  padding:10px;
}

/* MENU ITEM */
.menu-item{
  padding:14px;
  border-radius:14px;
  margin-bottom:8px;
  background:#23233b;
}
.menu-item.danger{
  background:#3a1f28;
}
.menu-item small{
  opacity:.7;
  float:right;
}

/* EXIT OVERLAY */
#exitOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:2000;
}
.fadeOut{
  animation:trash .6s forwards;
}
@keyframes trash{
  to{opacity:0;transform:scale(.6) translateY(40px)}
}
</style>
</head>

<body>

<header class="room-header">
  <div>üëª Ghost Room</div>
  <button id="menuBtn" class="menu-btn">‚ò∞</button>
</header>

<div class="messages" id="messages">
  <div class="system">üëª You are anonymous here. Silence is allowed.</div>
</div>

<div class="input-bar">
  <input id="msgInput" placeholder="Type without being known‚Ä¶">
  <button class="send" id="sendBtn">Send</button>
</div>

<!-- MENU -->
<div id="menuOverlay" class="menu-overlay">
  <div class="menu">
    <div class="menu-item">
      üí§ Inactivity
      <small id="timerText">30m</small>
    </div>
    <div class="menu-item" id="shareBtn">
      üîó Share quietly
    </div>
    <div class="menu-item danger" id="exitBtn">
      üóëÔ∏è Leave without a trace
    </div>
  </div>
</div>

<!-- EXIT -->
<div id="exitOverlay">
  <div>Messages fading‚Ä¶</div>
  <div style="font-size:64px;margin-top:20px">üóëÔ∏è</div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const menuBtn = document.getElementById("menuBtn");
const overlay = document.getElementById("menuOverlay");
const sendBtn = document.getElementById("sendBtn");
const msgInput = document.getElementById("msgInput");
const messages = document.getElementById("messages");
const exitBtn = document.getElementById("exitBtn");
const exitOverlay = document.getElementById("exitOverlay");
const shareBtn = document.getElementById("shareBtn");
const timerText = document.getElementById("timerText");

let lastActivity = Date.now();
const LIMIT = 30*60*1000;

/* MENU */
menuBtn.onclick = ()=> overlay.style.display="block";
overlay.onclick = (e)=>{
  if(e.target === overlay) overlay.style.display="none";
};

/* SEND */
sendBtn.onclick = ()=>{
  const t = msgInput.value.trim();
  if(!t) return;
  lastActivity = Date.now();
  const d = document.createElement("div");
  d.className="msg you";
  d.textContent=t;
  messages.appendChild(d);
  msgInput.value="";
  messages.scrollTop = messages.scrollHeight;
};

/* SHARE */
shareBtn.onclick = async ()=>{
  try{
    if(navigator.share){
      await navigator.share({ url: location.href });
    }else{
      await navigator.clipboard.writeText(location.href);
      alert("Room link copied");
    }
  }catch(e){}
};

/* EXIT */
exitBtn.onclick = async ()=>{
  overlay.style.display="none";
  exitOverlay.style.display="flex";
  document.querySelectorAll(".msg").forEach(m=>m.classList.add("fadeOut"));
  await new Promise(r=>setTimeout(r,900));
  location.href="/";
};

/* TIMER */
setInterval(()=>{
  const left = LIMIT - (Date.now()-lastActivity);
  const m = Math.max(0,Math.floor(left/60000));
  const s = Math.max(0,Math.floor((left%60000)/1000));
  timerText.textContent = `${m}m ${s}s`;
  if(left<=0) exitBtn.onclick();
},1000);

});
</script>

</body>
</html>
