<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IRA Room</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* ================= BASE ================= */
body{
  margin:0;
  font-family:Inter,system-ui;
  background:radial-gradient(circle at top,#141633,#050507 70%);
  color:#fff;
  overflow:hidden;
}

/* ================= HEADER ================= */
.room-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  background:rgba(10,11,20,.75);
  backdrop-filter:blur(10px);
  border-bottom:1px solid rgba(255,255,255,.06);
}

.header-left{
  display:flex;
  align-items:center;
  gap:10px;
}

.logo-img{
  width:32px;
  height:32px;
  border-radius:50%;
  animation:breath 7s ease-in-out infinite;
}

.logo-text{
  font-weight:600;
  letter-spacing:.4px;
}

@keyframes breath{
  0%,100%{ opacity:.9 }
  50%{ opacity:1 }
}

.menu-btn{
  font-size:22px;
  background:none;
  border:none;
  color:white;
  cursor:pointer;
}

/* ================= CHAT ================= */
.messages{
  padding:18px 14px;
  height:calc(100vh - 128px);
  overflow-y:auto;
  display:flex;
  flex-direction:column;
}

.msg{
  max-width:78%;
  padding:12px 16px;
  margin-bottom:12px;
  font-size:14px;
  line-height:1.45;
  animation:pop .18s ease-out;
}

.msg.you{
  align-self:flex-end;
  background:linear-gradient(135deg,#6F7CFF,#8E97FF);
  border-radius:18px 18px 6px 18px;
}

.system{
  text-align:center;
  color:rgba(255,255,255,.55);
  font-size:13px;
  margin:26px 0;
}

@keyframes pop{
  from{opacity:0;transform:scale(.95)}
  to{opacity:1;transform:none}
}

/* ================= INPUT ================= */
.input-bar{
  display:flex;
  gap:10px;
  padding:12px;
  background:rgba(10,11,20,.85);
  backdrop-filter:blur(10px);
  border-top:1px solid rgba(255,255,255,.06);
}

.input-bar input{
  flex:1;
  padding:12px 16px;
  border-radius:20px;
  border:none;
  background:#141633;
  color:white;
  font-size:14px;
  outline:none;
}

.send{
  padding:12px 18px;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,#6F7CFF,#8E97FF);
  color:white;
  font-weight:600;
  cursor:pointer;
}

/* ================= MENU OVERLAY ================= */
.menu-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  backdrop-filter:blur(6px);
  display:none;
  z-index:1000;
}

/* ================= MENU CARD ================= */
.menu{
  position:absolute;
  top:64px;
  right:12px;
  width:220px;
  background:rgba(20,22,45,.78);
  backdrop-filter:blur(14px);
  border-radius:18px;
  padding:10px;
  box-shadow:0 20px 40px rgba(0,0,0,.45);
}

.menu-item{
  padding:14px;
  border-radius:14px;
  margin-bottom:8px;
  background:#23233b;
  font-size:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.menu-item.danger{
  background:#3a1f28;
}

.menu-item:last-child{margin-bottom:0}

/* ================= EXIT OVERLAY ================= */
#exitOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:2000;
  text-align:center;
}

.fadeOut{
  animation:trash .6s forwards;
}

@keyframes trash{
  to{opacity:0;transform:scale(.6) translateY(40px)}
}
</style>
</head>

<body>

<header class="room-header">
  <div class="header-left">
    <img src="ira-logo.png" class="logo-img" alt="IRA">
    <span class="logo-text">IRA</span>
  </div>
  <button id="menuBtn" class="menu-btn">‚ò∞</button>
</header>

<div class="messages" id="messages">
  <div class="system">You are anonymous here. Silence is allowed.</div>
</div>

<div class="input-bar">
  <input id="msgInput" placeholder="Type without being known‚Ä¶">
  <button class="send" id="sendBtn">Send</button>
</div>

<!-- MENU -->
<div id="menuOverlay" class="menu-overlay">
  <div class="menu">
    <div class="menu-item">
      üí§ Inactivity
      <span id="timerText">30m</span>
    </div>
    <div class="menu-item" id="shareBtn">
      üîó Share quietly
    </div>
    <div class="menu-item danger" id="exitBtn">
      üóëÔ∏è Leave without a trace
    </div>
  </div>
</div>

<!-- EXIT -->
<div id="exitOverlay">
  <div style="opacity:.7">Messages fading‚Ä¶</div>
  <div style="font-size:64px;margin-top:20px">üóëÔ∏è</div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const menuBtn = document.getElementById("menuBtn");
const overlay = document.getElementById("menuOverlay");
const sendBtn = document.getElementById("sendBtn");
const msgInput = document.getElementById("msgInput");
const messages = document.getElementById("messages");
const exitBtn = document.getElementById("exitBtn");
const exitOverlay = document.getElementById("exitOverlay");
const shareBtn = document.getElementById("shareBtn");
const timerText = document.getElementById("timerText");

let lastActivity = Date.now();
const LIMIT = 30*60*1000;

/* MENU */
menuBtn.onclick = ()=> overlay.style.display="block";
overlay.onclick = (e)=>{
  if(e.target === overlay) overlay.style.display="none";
};

/* SEND */
sendBtn.onclick = ()=>{
  const t = msgInput.value.trim();
  if(!t) return;
  lastActivity = Date.now();
  const d = document.createElement("div");
  d.className="msg you";
  d.textContent=t;
  messages.appendChild(d);
  msgInput.value="";
  messages.scrollTop = messages.scrollHeight;
};

/* SHARE */
shareBtn.onclick = async ()=>{
  try{
    if(navigator.share){
      await navigator.share({ url: location.href });
    }else{
      await navigator.clipboard.writeText(location.href);
      alert("Room link copied");
    }
  }catch(e){}
};

/* EXIT */
exitBtn.onclick = async ()=>{
  overlay.style.display="none";
  exitOverlay.style.display="flex";
  document.querySelectorAll(".msg").forEach(m=>m.classList.add("fadeOut"));
  await new Promise(r=>setTimeout(r,900));
  location.href="/";
};

/* TIMER */
setInterval(()=>{
  const left = LIMIT - (Date.now()-lastActivity);
  const m = Math.max(0,Math.floor(left/60000));
  const s = Math.max(0,Math.floor((left%60000)/1000));
  timerText.textContent = `${m}m ${s}s`;
  if(left<=0) exitBtn.onclick();
},1000);

});
</script>

</body>
</html>
